import{Q as K}from"./QBanner.077b56c4.js";import{_ as z,aC as A,a as F,b as s,C as n,a8 as R,aD as x,x as d,c as H,aE as G,ay as J,o as S,k as O,g as c,f as l,n as b,d as I,p as y,t as k,J as Q,v as j,m as W,L as T,aF as X,aG as Y,Q as U,h as P,i as V,aH as Z,s as $,aI as q,O as ee,aJ as C}from"./index.9d18405d.js";import{Q as ae,a as oe}from"./QLayout.b14b33df.js";var le="/app/assets/company-logo.6eb4ff1e.png";const se={name:"LoginPage",beforeRouteEnter(a,t,u){let e="/login";C==="1"?e="/home":(C==="2"||C==="0")&&(e="/teacher/home"),a.path==="/login"&&A.value?u({path:e}):u()},setup(){const a=F();localStorage.getItem(s.userLang);const t=n(!0),u=n(!0),e=n("bg-red"),f=n("Checking database...");R(()=>{const o=()=>{setTimeout(()=>{u.value=!1},3e3)};setTimeout(()=>{x.get(`${s.coreAPI}check-db`).then(({data:p})=>{p.shouldUpdate===1?(f.value=d("db_progress"),x.get(`${s.coreAPI}update-db`).then(({data:h})=>{setTimeout(()=>{f.value=d("db_updated"),e.value="bg-green",t.value=!1},2e3),o()})):(e.value="bg-green",f.value=d("db_uptodate"),t.value=!1,o())})},1e3)});const v=n(""),i=n(""),M=n({}),m=n(""),g=n("black"),w=n(!1),_=n(!1);return{usernameLabel:H(()=>`Username / NIG (${d("login_nig")})`),conf:s,companyLogoPushLeft:a.screen.lt.sm?"left: 27%":"left: 30%",styleSelector(o){const p={light:{bgImage:"bg-img-light",card:"",icon:"primary",label:"",input:"auth-input",inputColor:"input-color",btn:"blue",poweredLogo:"powered-style"},dark:{bgImage:"bg-img-dark",card:"auth-box-dark",icon:"blue-1",label:"blue-1",input:"auth-input-dark",inputColor:"input-color-dark",btn:"cyan-10",poweredLogo:""}};return a.cookies.get("theme")==="dark"?p.dark[o]:p.light[o]},validate(){m.value="",w.value=!0;const o=()=>w.value=!1;if(v.value===""||i.value==="")m.value=d("userpassword_wajib"),g.value="negative",setTimeout(o,6e3);else{const p={username:v.value,password:i.value,remember:_.value?1:0};m.value=d("mengautentikasi"),g.value=a.cookies.get("theme")==="dark"?"white":"black",x.post(`${s.coreAPI}login/validasi`,p,{transformRequest:[h=>G(h)]}).then(h=>{const r=h.data;if(r.msg==="expired")g.value="negative",m.value=r.note;else if(r.msg==="valid"){m.value=d("login_sukses"),g.value="positive",_.value&&(s.cookieExp*=12*30);const D=new Date,N=D.getTime(),B=N+s.cookieExp,E=new Date(B),L={expires:E.toUTCString(),path:"/",sameSite:"None",secure:!0};a.cookies.set(s.cookieName,r.token,L),a.cookies.set(s.userType,r.level,L),localStorage.getItem("copy_presence")===null&&localStorage.setItem("copy_presence",0),localStorage.setItem(s.userLang,r.lang),r.level==="1"?(window.location.href=s.homeUrl(),localStorage.removeItem("grade_id")):(r.level==="2"||r.level==="0")&&(localStorage.setItem("grade_id",r.grade),window.location.href=s.teacherHomeUrl())}else r.msg==="unauthorized"?(g.value="negative",m.value=d("salah_akses"),setTimeout(o,8e3)):(g.value="negative",m.value=d("invalid_login"),setTimeout(o,4e3))})}},username:v,password:i,error:M,msg:m,msgClass:g,showMsg:w,rememberMe:_,dbUpdate:t,progressColor:e,showUpdateProgress:u,dbProgressText:f,btnStyle:J({fontSize:"18px",width:"calc(100% - 5px)",borderRadius:a.screen.lt.sm?"28px":"5px"}),pleaseLoginText:a.screen.lt.sm?"q-pb-sm":"",brandLogo:()=>{let o;return a.cookies.get("theme")==="dark"?o="siabsen-logo-white":o="siabsen-logo",`${o}.png`}}}},te={key:0,class:"q-pa-md q-gutter-sm"},re={class:"q-pa-md q-mt-md row items-start q-gutter-md"},ne={id:"company-logo",class:"col-12 col-md-4 col-sm-8 offset-md-4 offset-sm-2"};function ie(a,t,u,e,f,v){return S(),O(oe,{view:"hHh lpR fFf"},{default:c(()=>[l(ae,{class:b(["bg-login",e.styleSelector("bgImage")])},{default:c(()=>[e.showUpdateProgress?(S(),I("div",te,[l(K,{"inline-actions":"",rounded:"",class:b([e.progressColor,"text-white text-center"])},{default:c(()=>[y("strong",null,k(e.dbProgressText),1)]),_:1},8,["class"])])):Q("",!0),y("div",re,[l(j,{class:b(["auth-box col-md-4 col-sm-8 offset-md-4 offset-sm-2",e.styleSelector("card")])},{default:c(()=>[l(W,null,{default:c(()=>[l(T,{src:e.brandLogo(),width:"30%",ratio:1,class:"app-logo"},null,8,["src"]),y("p",{class:b(["text-center text-uppercase q-pt-lg",e.pleaseLoginText])},k(a.$t("silakan_login")),3),l(X,{class:"q-gutter-xs",onSubmit:Y(e.validate,["prevent"])},{default:c(()=>[l(U,{filled:"",class:"q-mb-md",modelValue:e.username,"onUpdate:modelValue":t[0]||(t[0]=i=>e.username=i),label:e.usernameLabel,onKeyup:P(e.validate,["enter"]),"label-color":e.styleSelector("label"),color:e.styleSelector("icon"),disable:e.dbUpdate},{prepend:c(()=>[l(V,{name:"mail_outline"})]),_:1},8,["modelValue","label","onKeyup","label-color","color","disable"]),l(U,{type:"password",filled:"",modelValue:e.password,"onUpdate:modelValue":t[1]||(t[1]=i=>e.password=i),label:"Password",onKeyup:P(e.validate,["enter"]),"label-color":e.styleSelector("label"),disable:e.dbUpdate},{prepend:c(()=>[l(V,{name:"vpn_key"})]),_:1},8,["modelValue","onKeyup","label-color","disable"]),l(Z,{color:"primary","keep-color":"",class:"q-mb-lg",modelValue:e.rememberMe,"onUpdate:modelValue":t[2]||(t[2]=i=>e.rememberMe=i),label:a.$t("remember_me")},null,8,["modelValue","label"]),e.showMsg?(S(),I("p",{key:0,style:{"margin-top":"-20px"},class:b(`text-bold text-${e.msgClass}`)},k(e.msg),3)):Q("",!0),l($,{color:e.styleSelector("btn"),onClick:e.validate,style:q(e.btnStyle),disable:e.dbUpdate},{default:c(()=>[ee(k(a.$t("login")),1)]),_:1},8,["color","onClick","style","disable"])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["class"]),y("div",ne,[l(T,{class:b(e.styleSelector("poweredLogo")),src:le,width:"40%",style:q(e.companyLogoPushLeft)},null,8,["class","style"])])])]),_:1},8,["class"])]),_:1})}var ge=z(se,[["render",ie]]);export{ge as default};
