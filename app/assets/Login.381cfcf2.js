import{Q as K}from"./QBanner.b114e618.js";import{_ as z,aB as A,a as F,b as s,C as r,a8 as R,ap as x,c as H,x as p,aC as G,ax as O,o as S,k as j,g as d,f as a,n as f,d as L,p as y,t as k,J as Q,v as J,m as W,L as U,aD as X,aE as Y,Q as P,h as T,i as V,aF as Z,s as $,aG as q,O as ee,aH as C}from"./index.eff39408.js";import{Q as ae,a as oe}from"./QLayout.07003c1a.js";import{_ as le}from"./icon-512x512.84c0ad7c.js";var se="/app/assets/company-logo.6eb4ff1e.png";const te={name:"LoginPage",beforeRouteEnter(o,t,u){let e="/login";C==="1"?e="/home":(C==="2"||C==="0")&&(e="/teacher/home"),o.path==="/login"&&A.value?u({path:e}):u()},setup(){const o=F();localStorage.getItem(s.userLang);const t=r(!0),u=r(!0),e=r("bg-red"),b=r("Checking database...");R(()=>{const i=()=>{setTimeout(()=>{u.value=!1},3e3)};setTimeout(()=>{x.get(`${s.coreAPI}check-db`).then(({data:g})=>{g.shouldUpdate===1?(b.value="Loading the latest database version...",x.get(`${s.coreAPI}update-db`).then(({data:h})=>{setTimeout(()=>{b.value="Database update complete",e.value="bg-green",t.value=!1},2e3),i()})):(e.value="bg-green",b.value="Database is up to date.",t.value=!1,i())})},1e3)});const v=r(""),n=r(""),D=r({}),c=r(""),m=r("black"),_=r(!1),w=r(!1);return{usernameLabel:H(()=>`Username / NIG (${p("login_nig")})`),conf:s,companyLogoPushLeft:o.screen.lt.sm?"left: 27%":"left: 30%",styleSelector(i){const g={light:{bgImage:"bg-img-light",card:"",icon:"primary",label:"",input:"auth-input",inputColor:"input-color",btn:"blue",poweredLogo:"powered-style"},dark:{bgImage:"bg-img-dark",card:"auth-box-dark",icon:"blue-1",label:"blue-1",input:"auth-input-dark",inputColor:"input-color-dark",btn:"cyan-10",poweredLogo:""}};return o.cookies.get("theme")==="dark"?g.dark[i]:g.light[i]},validate(){c.value="",_.value=!0;const i=()=>_.value=!1;if(v.value===""||n.value==="")c.value=p("userpassword_wajib"),m.value="negative",setTimeout(i,6e3);else{const g={username:v.value,password:n.value,remember:w.value?1:0};c.value=p("mengautentikasi"),m.value=o.cookies.get("theme")==="dark"?"white":"black",x.post(`${s.coreAPI}login/validasi`,g,{transformRequest:[h=>G(h)]}).then(h=>{const l=h.data;if(l.msg==="expired"||l.msg==="maximum_session")m.value="negative",c.value=l.note;else if(l.msg==="valid"){c.value=p("login_sukses"),m.value="positive",w.value&&(s.cookieExp*=12*30);const M=new Date,B=M.getTime(),N=B+s.cookieExp,E=new Date(N),I={expires:E.toUTCString(),path:"/",sameSite:"None",secure:!0};o.cookies.set(s.cookieName,l.token,I),o.cookies.set(s.userType,l.level,I),localStorage.getItem("copy_presence")===null&&localStorage.setItem("copy_presence",0),localStorage.setItem(s.userLang,l.lang),l.level==="1"?(window.location.href=s.homeUrl(),localStorage.removeItem("grade_id")):(l.level==="2"||l.level==="0")&&(localStorage.setItem("grade_id",l.grade),window.location.href=s.teacherHomeUrl())}else l.msg==="unauthorized"?(m.value="negative",c.value=p("salah_akses"),setTimeout(i,8e3)):(m.value="negative",c.value=p("invalid_login"),setTimeout(i,4e3))})}},username:v,password:n,error:D,msg:c,msgClass:m,showMsg:_,rememberMe:w,dbUpdate:t,progressColor:e,showUpdateProgress:u,dbProgressText:b,btnStyle:O({fontSize:"18px",width:"calc(100% - 5px)",borderRadius:o.screen.lt.sm?"28px":"5px"})}}},re={key:0,class:"q-pa-md q-gutter-sm"},ne={class:"q-pa-md q-mt-md row items-start q-gutter-md"},ie={class:"text-center text-uppercase q-pt-lg q-pb-sm"},de={id:"company-logo",class:"col-12 col-md-4 col-sm-8 offset-md-4 offset-sm-2"};function ce(o,t,u,e,b,v){return S(),j(oe,{view:"hHh lpR fFf"},{default:d(()=>[a(ae,{class:f(["bg-login",e.styleSelector("bgImage")])},{default:d(()=>[e.showUpdateProgress?(S(),L("div",re,[a(K,{"inline-actions":"",rounded:"",class:f([e.progressColor,"text-white text-center"])},{default:d(()=>[y("strong",null,k(e.dbProgressText),1)]),_:1},8,["class"])])):Q("",!0),y("div",ne,[a(J,{class:f(["auth-box col-md-4 col-sm-8 offset-md-4 offset-sm-2",e.styleSelector("card")])},{default:d(()=>[a(W,null,{default:d(()=>[a(U,{src:le,width:"20%",ratio:1,class:"app-logo"}),y("p",ie,k(o.$t("silakan_login")),1),a(X,{class:"q-gutter-xs",onSubmit:Y(e.validate,["prevent"])},{default:d(()=>[a(P,{filled:"",class:"q-mb-md",modelValue:e.username,"onUpdate:modelValue":t[0]||(t[0]=n=>e.username=n),label:e.usernameLabel,onKeyup:T(e.validate,["enter"]),"label-color":e.styleSelector("label"),color:e.styleSelector("icon"),disable:e.dbUpdate},{prepend:d(()=>[a(V,{name:"mail_outline"})]),_:1},8,["modelValue","label","onKeyup","label-color","color","disable"]),a(P,{type:"password",filled:"",modelValue:e.password,"onUpdate:modelValue":t[1]||(t[1]=n=>e.password=n),label:"Password",onKeyup:T(e.validate,["enter"]),"label-color":e.styleSelector("label"),disable:e.dbUpdate},{prepend:d(()=>[a(V,{name:"vpn_key"})]),_:1},8,["modelValue","onKeyup","label-color","disable"]),a(Z,{color:"primary","keep-color":"",class:"q-mb-lg",modelValue:e.rememberMe,"onUpdate:modelValue":t[2]||(t[2]=n=>e.rememberMe=n),label:o.$t("remember_me")},null,8,["modelValue","label"]),e.showMsg?(S(),L("p",{key:0,style:{"margin-top":"-20px"},class:f(`text-bold text-${e.msgClass}`)},k(e.msg),3)):Q("",!0),a($,{color:e.styleSelector("btn"),onClick:e.validate,style:q(e.btnStyle),disable:e.dbUpdate},{default:d(()=>[ee(k(o.$t("login")),1)]),_:1},8,["color","onClick","style","disable"])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["class"]),y("div",de,[a(U,{class:f(e.styleSelector("poweredLogo")),src:se,width:"40%",style:q(e.companyLogoPushLeft)},null,8,["class","style"])])])]),_:1},8,["class"])]),_:1})}var be=z(te,[["render",ce]]);export{be as default};
