import{Q as R}from"./QBanner.541dddf5.js";import{_ as z,aR as A,a as E,b as o,C as l,a8 as F,aL as w,c as O,x as p,aS as H,aO as j,o as x,k as G,g as n,f as t,n as f,d as I,p as _,t as y,J as Q,v as J,m as W,L as T,aT as X,aU as Y,Q as U,h as q,i as P,s as Z,aV as V,O as $,aW as S}from"./index.951da69c.js";import{Q as ee,a as ae}from"./QLayout.8748c87c.js";import{_ as oe}from"./icon-512x512.84c0ad7c.js";var te="/app/assets/company-logo.6eb4ff1e.png";const se={name:"LoginPage",beforeRouteEnter(s,r,u){let e="/login";S==="1"?e="/home":(S==="2"||S==="0")&&(e="/teacher/home"),s.path==="/login"&&A.value?u({path:e}):u()},setup(){const s=E();localStorage.getItem(o.userLang);const r=l(!0),u=l(!0),e=l("bg-red"),b=l("Checking database...");F(()=>{const i=()=>{setTimeout(()=>{u.value=!1},3e3)};setTimeout(()=>{w.get(`${o.coreAPI}check-db`).then(({data:g})=>{g.shouldUpdate===1?(b.value="Loading the latest database version...",w.get(`${o.coreAPI}update-db`).then(({data:h})=>{setTimeout(()=>{b.value="Database update complete",e.value="bg-green",r.value=!1},2e3),i()})):(e.value="bg-green",b.value="Database is up to date.",r.value=!1,i())})},1e3)});const v=l(""),c=l(""),D=l({}),d=l(""),m=l("black"),k=l(!1),C=l(!0);return{usernameLabel:O(()=>`Username / NIG (${p("login_nig")})`),conf:o,companyLogoPushLeft:s.screen.lt.sm?"left: 27%":"left: 30%",styleSelector(i){const g={light:{bgImage:"bg-img-light",card:"",icon:"primary",label:"",input:"auth-input",inputColor:"input-color",btn:"blue",poweredLogo:"powered-style"},dark:{bgImage:"bg-img-dark",card:"auth-box-dark",icon:"blue-1",label:"blue-1",input:"auth-input-dark",inputColor:"input-color-dark",btn:"cyan-10",poweredLogo:""}};return s.cookies.get("theme")==="dark"?g.dark[i]:g.light[i]},validate(){d.value="",k.value=!0;const i=()=>k.value=!1;if(v.value===""||c.value==="")d.value=p("userpassword_wajib"),m.value="negative",setTimeout(i,6e3);else{const g={username:v.value,password:c.value};d.value=p("mengautentikasi"),m.value=s.cookies.get("theme")==="dark"?"white":"black",w.post(`${o.coreAPI}login/validasi`,g,{transformRequest:[h=>H(h)]}).then(h=>{const a=h.data;if(a.msg==="expired"||a.msg==="maximum_session")m.value="negative",d.value=a.note;else if(a.msg==="valid"){d.value=p("login_sukses"),m.value="positive",C.value&&(o.cookieExp*=12*30*12);const M=new Date,N=M.getTime(),B=N+o.cookieExp,K=new Date(B),L={expires:K.toUTCString(),path:"/",sameSite:"None",secure:!0};s.cookies.set(o.cookieName,a.token,L),s.cookies.set(o.userType,a.level,L),localStorage.getItem("copy_presence")===null&&localStorage.setItem("copy_presence",0),localStorage.setItem(o.userLang,a.lang),a.level==="1"?(window.location.href=o.homeUrl(),localStorage.removeItem("grade_id")):(a.level==="2"||a.level==="0")&&(localStorage.setItem("grade_id",a.grade),window.location.href=o.teacherHomeUrl())}else a.msg==="unauthorized"?(m.value="negative",d.value=p("salah_akses"),setTimeout(i,8e3)):(m.value="negative",d.value=p("invalid_login"),setTimeout(i,4e3))})}},username:v,password:c,error:D,msg:d,msgClass:m,showMsg:k,rememberMe:C,dbUpdate:r,progressColor:e,showUpdateProgress:u,dbProgressText:b,btnStyle:j({fontSize:"18px",width:"calc(100% - 5px)",borderRadius:s.screen.lt.sm?"28px":"5px"})}}},le={key:0,class:"q-pa-md q-gutter-sm"},re={class:"q-pa-md q-mt-md row items-start q-gutter-md"},ie={class:"text-center text-uppercase q-pt-lg q-pb-sm"},ne={id:"company-logo",class:"col-12 col-md-4 col-sm-8 offset-md-4 offset-sm-2"};function de(s,r,u,e,b,v){return x(),G(ae,{view:"hHh lpR fFf"},{default:n(()=>[t(ee,{class:f(["bg-login",e.styleSelector("bgImage")])},{default:n(()=>[e.showUpdateProgress?(x(),I("div",le,[t(R,{"inline-actions":"",rounded:"",class:f([e.progressColor,"text-white text-center"])},{default:n(()=>[_("strong",null,y(e.dbProgressText),1)]),_:1},8,["class"])])):Q("",!0),_("div",re,[t(J,{class:f(["auth-box col-md-4 col-sm-8 offset-md-4 offset-sm-2",e.styleSelector("card")])},{default:n(()=>[t(W,null,{default:n(()=>[t(T,{src:oe,width:"20%",ratio:1,class:"app-logo"}),_("p",ie,y(s.$t("silakan_login")),1),t(X,{class:"q-gutter-xs",onSubmit:Y(e.validate,["prevent"])},{default:n(()=>[t(U,{filled:"",class:"q-mb-md",modelValue:e.username,"onUpdate:modelValue":r[0]||(r[0]=c=>e.username=c),label:e.usernameLabel,onKeyup:q(e.validate,["enter"]),"label-color":e.styleSelector("label"),color:e.styleSelector("icon"),disable:e.dbUpdate},{prepend:n(()=>[t(P,{name:"mail_outline"})]),_:1},8,["modelValue","label","onKeyup","label-color","color","disable"]),t(U,{type:"password",filled:"",modelValue:e.password,"onUpdate:modelValue":r[1]||(r[1]=c=>e.password=c),label:"Password",onKeyup:q(e.validate,["enter"]),"label-color":e.styleSelector("label"),disable:e.dbUpdate},{prepend:n(()=>[t(P,{name:"vpn_key"})]),_:1},8,["modelValue","onKeyup","label-color","disable"]),e.showMsg?(x(),I("p",{key:0,class:f(`text-bold text-${e.msgClass} q-mt-md`)},y(e.msg),3)):Q("",!0),t(Z,{color:e.styleSelector("btn"),onClick:e.validate,style:V(e.btnStyle),disable:e.dbUpdate,class:"q-mt-lg"},{default:n(()=>[$(y(s.$t("login")),1)]),_:1},8,["color","onClick","style","disable"])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["class"]),_("div",ne,[t(T,{class:f(e.styleSelector("poweredLogo")),src:te,width:"40%",style:V(e.companyLogoPushLeft)},null,8,["class","style"])])])]),_:1},8,["class"])]),_:1})}var pe=z(se,[["render",de]]);export{pe as default};
