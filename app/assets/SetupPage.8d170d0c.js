import{Q as y}from"./QImg.bb399902.js";import{aJ as D,aK as b,aL as u,b as S,aD as f,aM as d,_ as w,a as x,ax as V,a9 as Q,ah as C,o as P,k as z,g as r,f as a,p as g,v as T,n as q,m as B,aE as R,aF as U,Q as _,aN as o,i as m,j as F,s as N,aH as M,N as k,P as L,R as A}from"./index.c9c43840.js";import{Q as E,a as O}from"./QLayout.26a8b710.js";import{_ as G}from"./icon-512x512.84c0ad7c.js";const H=D("setup",{state:()=>({showProgressMessage:!0,progressMessage:"Installing %s module...",installSuccess:!1,postData:{organization_name:"",subscription_type:"Free",database_name:"",token:""},error:{},progressColor:"bg-accent",disableButton:!1,timeout:3e3}),actions:{checkInstallation(){const e=b.show({message:"Checking database installation...",group:"check"});u.get("check").then(({data:s})=>{s.status===1?(e({message:"Database has been installed, access to this feature is disabled. Redirecting to login page..."}),setTimeout(()=>{b.hide(),window.location.href=S.loginUrl()},4e3)):setTimeout(()=>{b.hide()},1e3)})},setupOrganization(){u.post("create-organization",this.postData,{transformRequest:[e=>f(e)]}).then(({data:e})=>{d.create({message:e.msg,spinner:!1,color:e.status==="failed"?"negative":"positive",icon:e.status==="failed"?"report_problem":"verified",position:"center",timeout:0}),setTimeout(()=>{window.location.href=S.loginUrl()},this.timeout+1e3)})},createTimelog(){this.doInstall("timelog",()=>{d.create({group:!1,spinner:!0,message:"Database successfully installed. Setting up organization details...",color:"positive",position:"center",timeout:this.timeout}),setTimeout(()=>{this.setupOrganization()},this.timeout)})},createSchool(){this.doInstall("school",()=>this.createTimelog())},createAgenda(){this.doInstall("agenda",()=>this.createSchool())},createPresence(){this.doInstall("presence",()=>this.createAgenda())},createSchedule(){this.doInstall("schedule",()=>this.createPresence())},createLesson(){this.doInstall("lessons",()=>this.createSchedule())},createRoom(){this.doInstall("room",()=>this.createLesson())},createStudent(){this.doInstall("student",()=>this.createRoom())},createGrade(){this.doInstall("grade",()=>this.createStudent())},createStaff(){this.doInstall("staff",()=>this.createGrade())},createParent(){this.doInstall("parent",()=>this.createStaff())},createUser(){this.doInstall("user",()=>this.createParent())},doInstall(e,s){const t=d.create({group:"notify",spinner:!0,message:this.progressMessage.replace("%s",e),color:"accent",position:"center",timeout:0});u.post(`create/${e}`,{token:this.postData.token},{transformRequest:[c=>f(c)]}).then(({data:c})=>{c.status==="OK"?setTimeout(()=>{e==="timelog"&&t(),s()},500):setTimeout(()=>{t(),d.create({message:"Installation failed, please provide a valid developer token.",timeout:this.timeout+1e3,icon:"report_problem",color:"negative",position:"center"}),this.disableButton=!1},1e3)})},validateForm(){this.showProgressMessage=!0,this.disableButton=!0;const e=d.create({group:!1,spinner:!0,message:"Validating forms...",color:"accent",position:"center",timeout:0});u.post("validate",this.postData,{transformRequest:[s=>f(s)]}).then(({data:s})=>{e({timeout:this.timeout}),s.status==="success"?(this.createUser(),e({timeout:1}),this.error={}):(e({color:"negative",message:"Unable to install database, please fill the form correctly.",icon:"report_problem",spinner:!1}),this.error=s.msg,this.disableButton=!1)})}}});const K=e=>(L("data-v-2995de9e"),e=e(),A(),e),$={class:"q-pa-md q-mt-md row items-start q-gutter-md"},j=K(()=>g("p",{class:"text-center text-uppercase q-pt-lg q-pb-sm"},[k(" Welcome to Actudent Database Installation page "),g("br"),g("strong",null,"This feature is intended to be used for developer only")],-1)),J={__name:"SetupPage",setup(e){const s=x(),t=H(),c=()=>{},I=["Free","Starter","Standard","Enhanced","Enterprise"],v=V({fontSize:"18px",width:"calc(100% - 5px)",borderRadius:s.screen.lt.sm?"28px":"5px"});Q(()=>t.checkInstallation());const n=h=>{const l={light:{bgImage:"bg-img-light",card:"",icon:"primary",label:"",input:"auth-input",inputColor:"input-color",btn:"blue",poweredLogo:"powered-style"},dark:{bgImage:"bg-img-dark",card:"auth-box-dark",icon:"blue-1",label:"blue-1",input:"auth-input-dark",inputColor:"input-color-dark",btn:"cyan-10",poweredLogo:""}};return s.cookies.get("theme")==="dark"?l.dark[h]:l.light[h]};return(h,l)=>{const p=C("ac-error");return P(),z(O,{view:"hHh lpR fFf",class:"bg-install"},{default:r(()=>[a(E,null,{default:r(()=>[g("div",$,[a(T,{class:q(["auth-box col-md-4 col-sm-8 offset-md-4 offset-sm-2",n("card")])},{default:r(()=>[a(B,null,{default:r(()=>[a(y,{src:G,width:"20%",ratio:1,class:"app-logo"}),j,a(R,{class:"q-gutter-xs",onSubmit:U(c,["prevent"])},{default:r(()=>[a(_,{filled:"",modelValue:o(t).postData.organization_name,"onUpdate:modelValue":l[0]||(l[0]=i=>o(t).postData.organization_name=i),label:"School Name","label-color":n("label"),color:n("icon")},{prepend:r(()=>[a(m,{name:"o_business"})]),_:1},8,["modelValue","label-color","color"]),a(p,{label:o(t).error.organization_name},null,8,["label"]),a(F,{filled:"",modelValue:o(t).postData.subscription_type,"onUpdate:modelValue":l[1]||(l[1]=i=>o(t).postData.subscription_type=i),options:I},{prepend:r(()=>[a(m,{name:"bookmarks"})]),_:1},8,["modelValue"]),a(p,{label:o(t).error.subscription_type},null,8,["label"]),a(_,{filled:"",modelValue:o(t).postData.database_name,"onUpdate:modelValue":l[2]||(l[2]=i=>o(t).postData.database_name=i),label:"Database Name (for Android API)","label-color":n("label"),color:n("icon")},{prepend:r(()=>[a(m,{name:"storage"})]),_:1},8,["modelValue","label-color","color"]),a(p,{label:o(t).error.database_name},null,8,["label"]),a(_,{filled:"",modelValue:o(t).postData.token,"onUpdate:modelValue":l[3]||(l[3]=i=>o(t).postData.token=i),label:"Developer Token","label-color":n("label"),color:n("icon")},{prepend:r(()=>[a(m,{name:"vpn_key"})]),_:1},8,["modelValue","label-color","color"]),a(p,{label:o(t).error.token},null,8,["label"]),a(N,{color:n("btn"),onClick:o(t).validateForm,style:M(v),disable:o(t).disableButton},{default:r(()=>[k("Install")]),_:1},8,["color","onClick","style","disable"])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["class"])])]),_:1})]),_:1})}}};var ee=w(J,[["__scopeId","data-v-2995de9e"]]);export{ee as default};
