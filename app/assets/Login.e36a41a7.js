import{Q as z}from"./QBanner.2ba792f3.js";import{_ as A,aT as E,a as R,b as s,C as r,a8 as F,aN as _,c as H,x as p,aU as O,aQ as j,o as x,k as G,g as i,f as t,n as b,d as I,p as y,t as k,J as T,v as J,m as W,L as Q,aV as X,aW as Y,Q as U,h as q,i as P,s as Z,aX as V,O as $,aY as S}from"./index.2954a718.js";import{Q as ee,a as ae}from"./QLayout.84a68525.js";var oe="/app/assets/company-logo.6eb4ff1e.png";const le={name:"LoginPage",beforeRouteEnter(a,n,g){let e="/login";S==="1"?e="/home":(S==="2"||S==="0")&&(e="/teacher/home"),a.path==="/login"&&E.value?g({path:e}):g()},setup(){const a=R();localStorage.getItem(s.userLang);const n=r(!0),g=r(!0),e=r("bg-red"),f=r("Checking database...");F(()=>{const o=()=>{setTimeout(()=>{g.value=!1},3e3)};setTimeout(()=>{_.get(`${s.coreAPI}check-db`).then(({data:u})=>{u.shouldUpdate===1?(f.value="Loading the latest database version...",_.get(`${s.coreAPI}update-db`).then(({data:h})=>{setTimeout(()=>{f.value="Database update complete",e.value="bg-green",n.value=!1},2e3),o()})):(e.value="bg-green",f.value="Database is up to date.",n.value=!1,o())})},1e3)});const v=r(""),c=r(""),D=r({}),d=r(""),m=r("black"),w=r(!1),L=r(!0);return{usernameLabel:H(()=>`Username / NIG (${p("login_nig")})`),conf:s,companyLogoPushLeft:a.screen.lt.sm?"left: 27%":"left: 30%",styleSelector(o){const u={light:{bgImage:"bg-img-light",card:"",icon:"primary",label:"",input:"auth-input",inputColor:"input-color",btn:"blue",poweredLogo:"powered-style"},dark:{bgImage:"bg-img-dark",card:"auth-box-dark",icon:"blue-1",label:"blue-1",input:"auth-input-dark",inputColor:"input-color-dark",btn:"cyan-10",poweredLogo:""}};return a.cookies.get("theme")==="dark"?u.dark[o]:u.light[o]},validate(){d.value="",w.value=!0;const o=()=>w.value=!1;if(v.value===""||c.value==="")d.value=p("userpassword_wajib"),m.value="negative",setTimeout(o,6e3);else{const u={username:v.value,password:c.value};d.value=p("mengautentikasi"),m.value=a.cookies.get("theme")==="dark"?"white":"black",_.post(`${s.coreAPI}login/validasi`,u,{transformRequest:[h=>O(h)]}).then(h=>{const l=h.data;if(l.msg==="expired"||l.msg==="maximum_session")m.value="negative",d.value=l.note;else if(l.msg==="valid"){d.value=p("login_sukses"),m.value="positive",L.value&&(s.cookieExp*=12*30*12);const N=new Date,M=N.getTime(),B=M+s.cookieExp,K=new Date(B),C={expires:K.toUTCString(),path:"/",sameSite:"None",secure:!0};a.cookies.set(s.cookieName,l.token,C),a.cookies.set(s.userType,l.level,C),localStorage.getItem("copy_presence")===null&&localStorage.setItem("copy_presence",0),localStorage.setItem(s.userLang,l.lang),l.level==="1"?(window.location.href=s.homeUrl(),localStorage.removeItem("grade_id")):(l.level==="2"||l.level==="0")&&(localStorage.setItem("grade_id",l.grade),window.location.href=s.teacherHomeUrl())}else l.msg==="unauthorized"?(m.value="negative",d.value=p("salah_akses"),setTimeout(o,8e3)):(m.value="negative",d.value=p("invalid_login"),setTimeout(o,4e3))})}},username:v,password:c,error:D,msg:d,msgClass:m,showMsg:w,rememberMe:L,dbUpdate:n,progressColor:e,showUpdateProgress:g,dbProgressText:f,btnStyle:j({fontSize:"18px",width:"calc(100% - 5px)",borderRadius:a.screen.lt.sm?"28px":"5px"}),pleaseLoginText:a.screen.lt.sm?"q-pb-sm":"",brandLogo:()=>{let o;return a.cookies.get("theme")==="dark"?o="siabsen-logo-white":o="siabsen-logo",`${o}.png`}}}},se={key:0,class:"q-pa-md q-gutter-sm"},te={class:"q-pa-md q-mt-md row items-start q-gutter-md"},re={id:"company-logo",class:"col-12 col-md-4 col-sm-8 offset-md-4 offset-sm-2"};function ne(a,n,g,e,f,v){return x(),G(ae,{view:"hHh lpR fFf"},{default:i(()=>[t(ee,{class:b(["bg-login",e.styleSelector("bgImage")])},{default:i(()=>[e.showUpdateProgress?(x(),I("div",se,[t(z,{"inline-actions":"",rounded:"",class:b([e.progressColor,"text-white text-center"])},{default:i(()=>[y("strong",null,k(e.dbProgressText),1)]),_:1},8,["class"])])):T("",!0),y("div",te,[t(J,{class:b(["auth-box col-md-4 col-sm-8 offset-md-4 offset-sm-2",e.styleSelector("card")])},{default:i(()=>[t(W,null,{default:i(()=>[t(Q,{src:e.brandLogo(),width:"30%",ratio:1,class:"app-logo"},null,8,["src"]),y("p",{class:b(["text-center text-uppercase q-pt-lg",e.pleaseLoginText])},k(a.$t("silakan_login")),3),t(X,{class:"q-gutter-xs",onSubmit:Y(e.validate,["prevent"])},{default:i(()=>[t(U,{filled:"",class:"q-mb-md",modelValue:e.username,"onUpdate:modelValue":n[0]||(n[0]=c=>e.username=c),label:e.usernameLabel,onKeyup:q(e.validate,["enter"]),"label-color":e.styleSelector("label"),color:e.styleSelector("icon"),disable:e.dbUpdate},{prepend:i(()=>[t(P,{name:"mail_outline"})]),_:1},8,["modelValue","label","onKeyup","label-color","color","disable"]),t(U,{type:"password",filled:"",modelValue:e.password,"onUpdate:modelValue":n[1]||(n[1]=c=>e.password=c),label:"Password",onKeyup:q(e.validate,["enter"]),"label-color":e.styleSelector("label"),disable:e.dbUpdate},{prepend:i(()=>[t(P,{name:"vpn_key"})]),_:1},8,["modelValue","onKeyup","label-color","disable"]),e.showMsg?(x(),I("p",{key:0,class:b(`text-bold text-${e.msgClass} q-mt-md`)},k(e.msg),3)):T("",!0),t(Z,{color:e.styleSelector("btn"),onClick:e.validate,style:V(e.btnStyle),disable:e.dbUpdate,class:"q-mt-lg"},{default:i(()=>[$(k(a.$t("login")),1)]),_:1},8,["color","onClick","style","disable"])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["class"]),y("div",re,[t(Q,{class:b(e.styleSelector("poweredLogo")),src:oe,width:"40%",style:V(e.companyLogoPushLeft)},null,8,["class","style"])])])]),_:1},8,["class"])]),_:1})}var me=A(le,[["render",ne]]);export{me as default};
