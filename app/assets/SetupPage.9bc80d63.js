import{aX as D,aY as g,aZ as m,b as S,a_ as h,a$ as d,_ as y,a as w,aO as V,a8 as T,ag as x,o as C,k as Q,g as i,f as t,p as f,v as B,n as U,m as q,L as z,aT as P,aU as R,Q as b,b0 as s,i as p,j as F,s as L,aV as M,O as I,b1 as N,b2 as O}from"./index.e1378c35.js";import{Q as A,a as H}from"./QLayout.bfe6b66e.js";import{_ as $}from"./icon-512x512.84c0ad7c.js";const E=D("setup",{state:()=>({showProgressMessage:!0,progressMessage:"Installing %s module...",installSuccess:!1,postData:{organization_name:"",subscription_type:"Free",database_name:"",token:"",db_user:"",db_password:""},error:{},progressColor:"bg-accent",disableButton:!1,timeout:3e3}),actions:{checkInstallation(){const a=g.show({message:"Checking database installation...",group:"check"});m.get("check").then(({data:o})=>{o.status===1?(a({message:"Database has been installed, access to this feature is disabled. Redirecting to login page..."}),setTimeout(()=>{g.hide(),window.location.href=S.loginUrl()},4e3)):setTimeout(()=>{g.hide()},1e3)}).catch(()=>{setTimeout(()=>{g.hide()},1e3)})},setupOrganization(){m.post("create-organization",this.postData,{transformRequest:[a=>h(a)]}).then(({data:a})=>{const o=d.create({message:a.msg,spinner:!1,color:a.status==="failed"?"negative":"positive",icon:a.status==="failed"?"report_problem":"verified",position:"center",timeout:0});setTimeout(()=>{o(),window.location.href=S.loginUrl()},this.timeout+1e3)})},createTimelog(){this.doInstall("timelog",()=>{d.create({group:!1,spinner:!0,message:"Database successfully installed. Setting up organization details...",color:"positive",position:"center",timeout:this.timeout}),setTimeout(()=>{this.setupOrganization()},this.timeout)})},createHolidays(){this.doInstall("holidays",()=>this.createTimelog())},createSetting(){this.doInstall("setting",()=>this.createHolidays())},createSchool(){this.doInstall("school",()=>this.createSetting())},createTimeline(){this.doInstall("timeline",()=>this.createSchool())},createAgenda(){this.doInstall("agenda",()=>this.createTimeline())},createPresence(){this.doInstall("presence",()=>this.createAgenda())},createSchedule(){this.doInstall("schedule",()=>this.createPresence())},createLesson(){this.doInstall("lessons",()=>this.createSchedule())},createRoom(){this.doInstall("room",()=>this.createLesson())},createStudent(){this.doInstall("student",()=>this.createRoom())},createGrade(){this.doInstall("grade",()=>this.createStudent())},createStaff(){this.doInstall("staff",()=>this.createGrade())},createParent(){this.doInstall("parent",()=>this.createStaff())},createSession(){this.doInstall("session",()=>this.createParent())},createUser(){this.doInstall("user",()=>this.createSession())},doInstall(a,o){const e=d.create({group:"notify",spinner:!0,message:this.progressMessage.replace("%s",a),color:"accent",position:"center",timeout:0});m.post(`create/${a}`,this.postData,{transformRequest:[u=>h(u)]}).then(({data:u})=>{u.status==="OK"?setTimeout(()=>{a==="timelog"&&e(),o()},500):setTimeout(()=>{e(),d.create({message:"Installation failed, please provide a valid developer token.",timeout:this.timeout+1e3,icon:"report_problem",color:"negative",position:"center"}),this.disableButton=!1},1e3)}).catch(()=>{e(),this.disableButton=!1})},setupDatabase(){this.disableButton=!0;const a=d.create({group:!1,spinner:!0,message:"Setting up database...",color:"accent",position:"center",timeout:0});m.post("setup-database",this.postData,{transformRequest:[o=>h(o)]}).then(({data:o})=>{o.status==="OK"?setTimeout(()=>{a(),this.createUser()},3e3):(a({color:"negative",message:"There is a problem while setting up the database.",icon:"report_problem",spinner:!1}),this.disableButton=!1)})},validateForm(){this.showProgressMessage=!0,this.disableButton=!0;const a=d.create({group:!1,spinner:!0,message:"Validating forms...",color:"accent",position:"center",timeout:0});m.post("validate",this.postData,{transformRequest:[o=>h(o)]}).then(({data:o})=>{a({timeout:this.timeout}),o.status==="success"?(this.setupDatabase(),a({timeout:1}),this.error={}):(a({color:"negative",message:"Unable to install database, please fill in the form correctly.",icon:"report_problem",spinner:!1}),this.error=o.msg,this.disableButton=!1)})}}});const G=a=>(N("data-v-50feb93b"),a=a(),O(),a),K={class:"q-pa-md q-mt-md row items-start q-gutter-md"},j=G(()=>f("p",{class:"text-center text-uppercase q-pt-lg q-pb-sm"},[I(" Welcome to Actudent Database Installation page "),f("br"),f("strong",null,"This feature is intended to be used for developer only")],-1)),W={__name:"SetupPage",setup(a){const o=w(),e=E(),u=()=>{},v=["Free","Starter","Standard","Enhanced","Enterprise"],k=V({fontSize:"18px",width:"calc(100% - 5px)",borderRadius:o.screen.lt.sm?"28px":"5px"});T(()=>e.checkInstallation());const r=_=>{const l={light:{bgImage:"bg-img-light",card:"",icon:"primary",label:"",input:"auth-input",inputColor:"input-color",btn:"blue",poweredLogo:"powered-style"},dark:{bgImage:"bg-img-dark",card:"auth-box-dark",icon:"blue-1",label:"blue-1",input:"auth-input-dark",inputColor:"input-color-dark",btn:"cyan-10",poweredLogo:""}};return o.cookies.get("theme")==="dark"?l.dark[_]:l.light[_]};return(_,l)=>{const c=x("ac-error");return C(),Q(H,{view:"hHh lpR fFf",class:"bg-install"},{default:i(()=>[t(A,null,{default:i(()=>[f("div",K,[t(B,{class:U(["auth-box col-md-4 col-sm-8 offset-md-4 offset-sm-2",r("card")])},{default:i(()=>[t(q,null,{default:i(()=>[t(z,{src:$,width:"20%",ratio:1,class:"app-logo"}),j,t(P,{class:"q-gutter-xs",onSubmit:R(u,["prevent"])},{default:i(()=>[t(b,{filled:"",modelValue:s(e).postData.organization_name,"onUpdate:modelValue":l[0]||(l[0]=n=>s(e).postData.organization_name=n),label:"School Name","label-color":r("label"),color:r("icon")},{prepend:i(()=>[t(p,{name:"o_business"})]),_:1},8,["modelValue","label-color","color"]),t(c,{label:s(e).error.organization_name},null,8,["label"]),t(F,{filled:"",modelValue:s(e).postData.subscription_type,"onUpdate:modelValue":l[1]||(l[1]=n=>s(e).postData.subscription_type=n),options:v},{prepend:i(()=>[t(p,{name:"bookmarks"})]),_:1},8,["modelValue"]),t(c,{label:s(e).error.subscription_type},null,8,["label"]),t(b,{filled:"",modelValue:s(e).postData.database_name,"onUpdate:modelValue":l[2]||(l[2]=n=>s(e).postData.database_name=n),label:"Database Name","label-color":r("label"),color:r("icon")},{prepend:i(()=>[t(p,{name:"storage"})]),_:1},8,["modelValue","label-color","color"]),t(c,{label:s(e).error.database_name},null,8,["label"]),t(b,{filled:"",modelValue:s(e).postData.db_user,"onUpdate:modelValue":l[3]||(l[3]=n=>s(e).postData.db_user=n),label:"Database user","label-color":r("label"),color:r("icon")},{prepend:i(()=>[t(p,{name:"account_circle"})]),_:1},8,["modelValue","label-color","color"]),t(c,{label:s(e).error.db_user},null,8,["label"]),t(b,{filled:"",modelValue:s(e).postData.db_password,"onUpdate:modelValue":l[4]||(l[4]=n=>s(e).postData.db_password=n),label:"Database password","label-color":r("label"),color:r("icon")},{prepend:i(()=>[t(p,{name:"lock_open"})]),_:1},8,["modelValue","label-color","color"]),t(c,{label:s(e).error.db_password},null,8,["label"]),t(b,{filled:"",modelValue:s(e).postData.token,"onUpdate:modelValue":l[5]||(l[5]=n=>s(e).postData.token=n),label:"Developer Token","label-color":r("label"),color:r("icon")},{prepend:i(()=>[t(p,{name:"vpn_key"})]),_:1},8,["modelValue","label-color","color"]),t(c,{label:s(e).error.token},null,8,["label"]),t(L,{color:r("btn"),onClick:s(e).validateForm,style:M(k),disable:s(e).disableButton},{default:i(()=>[I("Install")]),_:1},8,["color","onClick","style","disable"])]),_:1})]),_:1})]),_:1},8,["class"])])]),_:1})]),_:1})}}};var J=y(W,[["__scopeId","data-v-50feb93b"]]);export{J as default};
